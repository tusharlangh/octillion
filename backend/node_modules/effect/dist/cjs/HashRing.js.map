{"version":3,"file":"HashRing.js","names":["_Function","require","Hash","_interopRequireWildcard","Inspectable","Iterable","_Pipeable","_Predicate","PrimaryKey","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","TypeId","isHashRing","u","hasProperty","exports","make","options","self","create","Proto","baseWeight","Math","max","totalWeightCache","nodes","Map","ring","Symbol","iterator","map","values","pipe","pipeArguments","arguments","BaseProto","toJSON","_id","addMany","dual","args","weight","keys","toRemove","node","key","value","entry","Set","add","push","filter","addNodesToRing","round","j","length","string","sort","a","b","remove","delete","input","undefined","index","getIndexForInput","getShards","count","shards","Array","allocations","remaining","exclude","distances","shard","hash","shardHashes","distance","nodeCount","maxPerNode","floor","allAtMax","size","forEach","len","mid","lo","hi","distA","abs","distB","range"],"sources":["../../src/HashRing.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}