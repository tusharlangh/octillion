{"version":3,"file":"HashRing.js","names":["dual","Hash","Inspectable","Iterable","pipeArguments","hasProperty","PrimaryKey","TypeId","isHashRing","u","make","options","self","Object","create","Proto","baseWeight","Math","max","totalWeightCache","nodes","Map","ring","Symbol","iterator","map","values","n","pipe","arguments","BaseProto","toJSON","_id","get","addMany","args","weight","keys","toRemove","node","key","value","entry","Set","add","set","push","filter","has","addNodesToRing","round","i","j","length","string","sort","a","b","remove","delete","input","undefined","index","getIndexForInput","getShards","count","shards","Array","allocations","remaining","exclude","distances","shard","hash","shardHashes","distance","nodeCount","maxPerNode","floor","allAtMax","size","forEach","len","mid","lo","hi","distA","abs","distB","range"],"sources":["../../src/HashRing.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}